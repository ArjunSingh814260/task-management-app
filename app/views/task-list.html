<div class="task-list-container">
    <div class="page-header">
        <h2>Task List</h2>
        <button class="btn btn-primary" ng-click="taskListCtrl.addTask()">
            Add New Task
        </button>
    </div>

    <div class="alert alert-error" ng-if="taskListCtrl.error">
        {{ taskListCtrl.error }}
    </div>

    <div class="loading" ng-if="taskListCtrl.loading">
        <p>Loading tasks...</p>
    </div>

    <div class="filters-section" ng-if="!taskListCtrl.loading">
        <div class="filter-row">
            <div class="filter-group">
                <label for="search">Search Tasks:</label>
                <input 
                    type="text" 
                    id="search" 
                    ng-model="taskListCtrl.searchQuery" 
                    ng-change="taskListCtrl.applyFilters()"
                    class="form-control"
                    placeholder="Search by title...">
            </div>

            <div class="filter-group">
                <label for="statusFilter">Filter by Status:</label>
                <select 
                    id="statusFilter" 
                    ng-model="taskListCtrl.statusFilter" 
                    ng-change="taskListCtrl.applyFilters()"
                    ng-options="status for status in taskListCtrl.statuses"
                    class="form-control">
                </select>
            </div>

            <div class="filter-group">
                <label>Sort by:</label>
                <div class="sort-buttons">
                    <button 
                        class="btn btn-sm" 
                        ng-class="{'btn-active': taskListCtrl.sortBy === 'dueDate'}"
                        ng-click="taskListCtrl.toggleSort('dueDate')">
                        Due Date
                        <span ng-if="taskListCtrl.sortBy === 'dueDate'">
                            {{ taskListCtrl.sortReverse ? '↓' : '↑' }}
                        </span>
                    </button>
                    <button 
                        class="btn btn-sm" 
                        ng-class="{'btn-active': taskListCtrl.sortBy === 'title'}"
                        ng-click="taskListCtrl.toggleSort('title')">
                        Title
                        <span ng-if="taskListCtrl.sortBy === 'title'">
                            {{ taskListCtrl.sortReverse ? '↓' : '↑' }}
                        </span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div class="tasks-grid" ng-if="!taskListCtrl.loading">
        <div ng-if="taskListCtrl.filteredTasks.length === 0" class="empty-state">
            <p>No tasks found. <a href="#/tasks/add">Create your first task</a></p>
        </div>

        <div 
            class="task-card" 
            ng-repeat="task in taskListCtrl.filteredTasks track by task.id"
            ng-class="{'dragging': taskListCtrl.draggedTask === task, 'drag-over': taskListCtrl.dragOverIndex === $index, 'drag-disabled': taskListCtrl.isDragDisabled()}"
            ng-attr-draggable="{{!taskListCtrl.isDragDisabled() ? 'true' : 'false'}}"
            ng-attr-data-index="{{$index}}"
            ng-dragstart="taskListCtrl.onDragStart($event, task, $index)"
            ng-dragover="taskListCtrl.onDragOver($event, $index)"
            ng-dragleave="taskListCtrl.onDragLeave($event)"
            ng-drop="taskListCtrl.onDrop($event, $index)"
            ng-dragend="taskListCtrl.onDragEnd($event)">
            <div class="drag-handle" ng-if="!taskListCtrl.isDragDisabled()" title="Drag to reorder tasks">
                <span class="drag-icon">⋮⋮</span>
            </div>
            <div class="task-header">
                <h3 class="task-title">{{ task.title }}</h3>
              
            </div>

            <div class="task-body">
                <p class="task-description">{{ task.description }}</p>
                <span class="task-status" ng-class="task.status | statusClass">
                    {{ task.status }}
                </span>
                <div class="task-meta">
                   
                    <span class="task-due-date">
                        <strong>Due:</strong> {{ task.dueDate | formatDate }}
                    </span>
                </div>
              
            </div>

            <div class="task-actions">
                <button 
                    class="btn btn-sm btn-secondary" 
                    ng-click="taskListCtrl.editTask(task.id)"
                    ng-disabled="!taskListCtrl.canEdit(task)">
                    Edit
                </button>
                <button 
                    class="btn btn-sm btn-success" 
                    ng-click="taskListCtrl.markAsCompleted(task.id)"
                    ng-disabled="task.status === 'Completed'">
                    Mark Complete
                </button>
            </div>
        </div>
    </div>
</div>

